-   [corpuslingr:](#corpuslingr)
-   [Web scraping functions](#web-scraping-functions)
    -   [GetGoogleNewsMeta()](#getgooglenewsmeta)
    -   [GetWebTexts()](#getwebtexts)
-   [Corpus preparation](#corpus-preparation)
    -   [SetSearchCorpus()](#setsearchcorpus)
    -   [GetDocDesc()](#getdocdesc)
-   [Search function and aggregate functions.](#search-function-and-aggregate-functions.)
    -   [An in-house corpus querying language (CQL)](#an-in-house-corpus-querying-language-cql)
    -   [SimpleSearch()](#simplesearch)
    -   [GetContexts()](#getcontexts)
    -   [GetSearchFreqs()](#getsearchfreqs)
    -   [GetKWIC()](#getkwic)
    -   [GetBOW()](#getbow)
    -   [GetKeyphrases()](#getkeyphrases)
-   [Multi-term search](#multi-term-search)
-   [Corpus workflow](#corpus-workflow)

corpuslingr:
------------

Some r functions for (1) quick web scraping and (2) corpus seach of complex grammatical constructions.

High Level utility. Hypothetical workflows. Independently or in conjunction. Academic linguists and digital humanists.

``` r
library(tidyverse)
library(cleanNLP)
library(stringi)
library(corpuslingr) #devtools::install_github("jaytimm/corpuslingr")
library(corpusdatr) #devtools::install_github("jaytimm/corpusdatr")
```

Web scraping functions
----------------------

These functions .... There are other packages/means to scrape the web. The two included here are designed for quick/easy search of headline news. And creation of tif corpus-object. making subsequent annotation straightforward. 'Scrape news -&gt; annotate -&gt; search' in three or four steps.

Following grammatical constructions ~ day-to-day changes, eg.

### GetGoogleNewsMeta()

``` r
dailyMeta <- corpuslingr::GetGoogleNewsMeta (search="New Mexico",n=30)

head(dailyMeta['titles'])
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["titles"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"New Mexico holds hundreds of people in prison past their release date"},{"1":"Colorado State comes up short against New Mexico"},{"1":"Stuck at the bottom: Why New Mexico fails to thrive | Education ..."},{"1":"Breaking down lawmakers' bills on kids and families"},{"1":"New Mexico Senior care services no longer on the chopping block"},{"1":"New Mexico invests in young entrepreneurs to kickstart its sluggish ..."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

### GetWebTexts()

This function ... takes the output of GetGoogleNews() (or any table with links to websites) ... and returns a 'tif as corpus df' Text interchange formats.

``` r
nm_news <- dailyMeta %>% 
  corpuslingr::GetWebTexts(link_var='links') %>%
  mutate(txt=stringi::stri_enc_toutf8(txt))

head(nm_news)
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["doc_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["links"],"name":[2],"type":["chr"],"align":["left"]},{"label":["source"],"name":[3],"type":["chr"],"align":["left"]},{"label":["titles"],"name":[4],"type":["chr"],"align":["left"]},{"label":["pubdates"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["date"],"align":["right"]},{"label":["txt"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"doc1","2":"http://amarillo.com/wt-sports/sports/college-sports/2018-01-27/wt-stampede-buffs-maul-western-new-mexico-99-55","3":"Amarillo.com","4":"WT stampede: Buffs maul Western New Mexico, 99-55 | amarillo.com","5":"Sun, 28 Jan 2018 04:12:07 GMT","6":"2018-01-28","7":"WT stampede: Buffs maul Western New Mexico, 99-55 Impact box   WT 99, Western NM 55 Records: No. 11-ranked West Texas A&M improves to 19-2 overall and 9-2 in the Lone Star Conference. Western New Mexico drops to 3-17, 0-11. Impact: West Texas moves to 30-1 in its last 31 home games. Next Up: Showdown time with first place UT Permian-Basin visiting West Texas A&M at 7:30 p.m. Tuesday. One sign of a good team regardless of the sport is doing the expected. West Texas was a very good team Saturday afternoon. Struggling Western New Mexico rolled into the First United Bank Center and the No. 11-ranked Buffs took care of business using an early 11-0 run as the catalyst for a lopsided 99-55 Lone Star Conference victory before 1,118 fans The win moved WT to 19-2 overall and sets up an LSC showdown Tuesday at the FUB with first-place University of Texas-Permian Basin. Western New Mexico departed the FUB still looking for win number one in the LSC dropping to 0-11. \"It was one of those things where they don't have a win in conference and it was close for a little bit there,\" said West Texas coach Tom Brown. \"What we did was do what we were supposed to do. We broke their will in the first half and that was good for us. We were able to get a lot of guys in.\" The Buffs faced little drama in this one as Western New Mexico plays the same up-tempo style of play. Except for the opening few minutes when the game was tied at seven, this one was all WT with all 11 Buff players scoring and grabbing a rebound, four finding double figures scoring led by Drew Evans' 23 points, and a total of 65 3-pointers attempted by both teams.in his nine WT used an 11-0 run midway through the first half to build a cushion resulting in a 44-21 halftime lead. Any question of a Western NM comeback was put to rest with 12:31 remaining in the first half when the Buffs moved the 23-point to 31 when senior guard David Chavlovich and sophomore Drew Evans combined on a highlight reel dunk for 63-32 lead. Chavlovich dribbled out past the 3-point arc on the wing then quickly lofted a back door pass to the 6-foot-3 Evans, who hammered home the dunk. Evans had his most productive game in LSC play this year going 8-of-11 from the floor, and making three steals. \"As a coach I probably enjoy a good box out or rebounds more than a dunk, but Drew played well for us and that's good to see,\" Brown said. \"He needs to get a few more rebounds for us. Everybody had a rebound and scored so that's good for us.\" Joining Evans in double figures for the Buffs were junior forward Ryan Quaid with 15, guard Jordan Evans added 12 and Chavlovich chipped in 12. Freshman Gaige Prim grabbed a team-high nine rebounds and scored four points in 13 minutes of action. Another highlight for the fans and the Buffs players was the nine points scored by freshman Sterling White of Happy in his nine minutes of play. The nine points included a dunk much celebrated with loud applause from the fans and smiles from the WT players on the bench. Western NM never found its offense shooting 16-of-65 from the floor (24.6 percent) and had one highlight in 6-f0ot-9 junior post Jon-Reese Wooden producing a double-double with 10 points and 12 rebounds. All in all, WT enjoyed this one and that meant simply winning a game it was supposed to according to season records. \"To see Ster do that and the whole bench play like that is fun for us all,\" Quaid said. \"Western New Mexico did not have a good record in conference and that's our job to have a game like this. Coaches are preaching to us to take care of business. It's not about how much we can beat this time by it's more about is this performance going to be good enough to beat the a Commerce, to be a UTPB, and to beat an in-region top team. That's what it's about. It's that point of the season.\" WT 99, WNM 55 Western New Mexico (3-17, 0-11): Latrell Spivey 0-0 0-0 0, CJ Vanbeekum 2-8 1-6 7, Jordan Enriquez 4-13 2-2 10, Willie McCray 0-9 4-6 4, Hane Vaughnwilson 2-11 1-2 5, Davis Wade 1-6 0-1 2, Jon-Reese Woodson 3-8 4-11 10, Alex Gonzalez 3-7 0-0 8, Eddie Giron 1-3 0-0 2, O'Shayne Reid 0-0 0-0 0. Totals 16-65 20-33 55. West Texas A&M (19-2, 9-2): David Chavlovich 4-10 0-0 12, CJ Jennings 1-7 0-0 2, Jordan Evans 5-10 0-1 13, Gach Gach 1-6 -0-0 3, Ryan Quaid 6-8 3-6 15, Drew Evans 8-11 5-5 23, Jordan Collins 2-6 2-2 7, Rylan Gerber 2-4 0-0 4, Gaige Prim 2-4 0-3 4, Wyatt Wheatly 2-5 -0-0 5, Sterling White 3-4 2-3 9. Totals 36-75 12-20 99. Western New Mexico;21;34-55 West Texas A&M;44;55-99 3-point goals: WNM: 3-23 (Vanbeekum 1-6, Gonzalez 2-6). WT: 15-42 (Chavlovich 4-9, Evans 3-8, Gach 1-4, Evans 2-5, Collins 1-3, Gerber 2-4, Wheatly 1-4, White 1-1). Rebounds: WNM: 50 (Woodson 12). WT: 51 (Prim 9). Steals: WNM 5 (McCray 3). WT: 11 (D. Evans 3). Blocked shots: WNM: 2 (Vanbeekum 1, Copper 1). WT: 6 (Prim 4). Turnovers: WNM 19 (Spivey 5). WT: 10 (Jennings 3). Total Fouls: WNM: 23. WT: 28. Fouled out: Jennings. Technicals: Prim. Officials: George Washington, Thomas Northcutt, John Schoepf. Attendance: 1,118. Lone Star Conference"},{"1":"doc2","2":"http://krqe.com/2018/01/27/new-mexico-senior-care-services-no-longer-on-the-chopping-block/","3":"KRQE News 13","4":"New Mexico Senior care services no longer on the chopping block","5":"Sun, 28 Jan 2018 05:55:00 GMT","6":"2018-01-28","7":"Click to share on Pinterest (Opens in new window) SANTA FE, N.M. (KRQE) - After concerns about a major disruption of senior services for tens of thousands of elderly New Mexicans. The state has changed its tune. The governor's administration had planned to cancel a contract that could have halted payments immediately to service providers, like Meals on Wheels and Homemaker Services, affecting more than 70,000 thousand seniors statewide. Democratic lawmakers say critical services that New Mexico seniors rely on are no longer at risk. \"I'm very grateful that the governor decided to rescind this original decision and that the aging alternative services department did the right thing by taking care of our seniors,\" said Sen. Howie Morales (D-Silver City). The New Mexico Department of Aging and Long-Term Services works with the Non-Metro Area Agency on Aging,\" or \"Triple A,\" Triple A reimburses dozens of providers like Meals on Wheels, Respite Care, Homemaker Services, and senior transportation services on behalf of the state. It's a contract Gov. Susana Martinez' administration planned to end after allegations of billing and reimbursement issues. \"We were given very little information, which is why myself and Rep. Armstrong stood strong with our position because there wasn't a clear reason why this change was occurring,\" Morales said. Morales said the group is crucial, distributing $20 million in funding to 65 different senior service providers in every single county outside Bernalillo. \"They depend on it with their life, and I think the opportunity to keep these services intact is extremely vital to ensure we can take care of our most vulnerable population in our state,\" Morales said. The contract does end in June, but Sen. Morales is hopeful they can renew the current contract or make adjustments to have other options up for discussion. New 13 reached out to the Governor's Office to find out what sparked the change of heart. We're told the Aging and Long-Term Services Department will release a statement on Monday. Share, Print or Email"},{"1":"doc3","2":"http://krwg.org/post/dry-conditions-cramp-new-mexico-water-supply-forecast","3":"KRWG","4":"Dry conditions cramp New Mexico water supply forecast","5":"Sat, 27 Jan 2018 21:47:29 GMT","6":"2018-01-27","7":"Dry conditions cramp New Mexico water supply forecast By News Editor And Partners . 20 hours ago   ALBUQUERQUE, N.M. (AP) - New Mexico's water resources could feel the pinch later this year thanks to dismal snowpack and a strengthening weather pattern in the Pacific Ocean that typically brings drier weather. The National Weather Service in Albuquerque issued an  update Friday on the water supply outlook. Senior hydrologist Royce Fontenot says drought has expanded across New Mexico in recent weeks. Severe conditions now cover 60 percent of the state. He said some areas, particularly in the eastern plains, have not seen any moisture for the last 100 days or so. He also said snowpack levels for all basins are well below normal and that will affect water supplies going forward. Forecasters estimate New Mexico would need as much as 270 percent of normal precipitation in some areas to recover by the spring."},{"1":"doc4","2":"http://krwg.org/post/message-new-mexico-investing-children-economic-development","3":"KRWG","4":"Message To New Mexico: Investing In Children Is Economic Development","5":"Sun, 28 Jan 2018 17:41:03 GMT","6":"2018-01-28","7":"Message To New Mexico: Investing In Children Is Economic Development By Sara Solovitch-searchlight new mexico . 8 minutes ago Tweet Share Google+ Email   Over the last two decades, New Mexico has turned its pockets inside out to keep old businesses from leaving and attract new ones to open their doors. It cut the capital gains tax, letting corporate interests retain more of their profits. It slashed the personal income tax for top earners by almost half, allowing the wealthy to hold onto more of their earnings. It chipped away at the gross receipts tax, so consumers could save money on their purchases. And every year it gave away more than $250 million in incentives, rebates, grants and loans -- all with the intent of luring new business to the state and growing the economy. But when it comes to return on investment -- be it in New Mexico or anywhere else -- many economists maintain there's a different kind of start-up, one that has a much surer payoff: kids. \"Think of a firm coming into New Mexico,\" said James Peach, a New Mexico State University economist with an interest in workforce readiness. \"They want good schools for the kids of their employees. They also want good schools because good schools eventually produce good workers. It's not all about the tax rate.\" There is emerging consensus around the country and the world that economic development and early childhood education go hand in hand. And nowhere is the relationship between child well-being and economic well-being more apparent than here in New Mexico, where poverty and a troubled education system are blamed for economic morass. \"If you ask me what relevance an underperforming education system has on our economic development and ability to attract and grow companies, the answer is everything,\" said Terri Cole, president of the Greater Albuquerque Chamber of Commerce. Cole and her group have advocated for education reform for the past 20 years, and she said the perspective of local businessmen and businesswomen has evolved, largely as a result of frustrations around workforce quality. \"I can tell you that the first five to seven years of our work, there was not a clear understanding of the relationship between our low-performing education system and economic development,\" Cole said. \"But it certainly exists today.\" Ask local business leaders about the effect of child poverty on the state economy and the response, almost invariably, is: \"Have you heard of James Heckman?\"   The reference is to the Nobel laureate economist at the University of Chicago, whose research over the past 30 years has zeroed in on the link between early childhood development and economic well-being. His conclusion, known as the Heckman Equation, found a 13 percent annual return on investment for comprehensive, high-quality, full-day early childhood education. His analysis of children who experienced that kind of early education showed they had better outcomes as measured by health, income, IQ, schooling and crime. The mothers' incomes increased as well, since they were able to depend on high-quality childcare after they returned to work.The Heckman Equation has been corroborated many times, most recently by the Center for American Progress, a nonpartisan policy institute based in Washington, D.C. In 2017, it reported the U.S. would see a net benefit of $83.3 billion for every year of high-quality preschool for 4-year-olds. Some studies have found a $17 return on every dollar invested.   Studies in New Mexico have found a $4.60 return on investment for every dollar invested in preschool education. The return is significantly less than the national figure due to a lack of full-day, high-quality programs in the state. Many of the benefits accrue to the education system itself, with reductions to special education and children being held back a grade. New Mexico has one of the highest rates of grade retention in the country, and research has shown that being held back can negatively impact a child's self-esteem. At a cost of $5,000, it is also expensive for the state, according to a report by the Legislative Finance Committee. Most of the monetary benefits can't be measured in a year's time. The rates of return for longitudinal early childhood education studies compare favorably with the U.S. stock market, according to a 2006 report. \"We know of the positive return on investment to such programs yet we haven't invested at the necessary rate to support children and families and our state's economic vitality,\" said Claire Dudley Chavez, executive vice president for policy and stakeholder engagement for the New Mexico Early Childhood Development Partnership. It is a bottom-line reality, and business leaders around the U.S. are well aware of it. Yet despite their awareness, the growth of childhood initiatives has continued to lag. In New Mexico, it has taken a particular toll on workforce readiness. Intel, the state's largest private employer, is widely rumored to have problems meeting its local labor force requirements. (The company declined to speak with Searchlight about the problem.) When Amazon announced it has narrowed the choices for its second headquarters -- a construction bonanza worth more than $5 billion - neither of the two bids from New Mexico (Albuquerque and Dona Ana County) made the cut. Peach, the economist at NMSU, saw that one coming months earlier: \"We're not going to get that,\" he'd scoffed at the time. \"And one of the big issues is workforce readiness. They're talking 50,000 employees - high-wage people who have to be highly educated. They've listed their criteria.\" Small-business owners struggle daily to find and keep reliable employees. Earlene Durand, the owner of Earlene's Public House Café, recently told The Taos News http://www.taosnews.com/stories/now-hiring,43477 that she had hired and lost 109 employees over the past two-and-a-half years; they either came to work late or didn't show up at all. \"The thing we constantly hear as we travel around the state is about the soft skills,\" said Jason Espinoza, president of the Association of Commerce and Industry, a statewide advocacy group that represents 250 small and large businesses. \"Teamwork. Showing up on time. Communication skills. Character development. Those are the skills employers are looking for. \"And where it starts is in the early years. We can't wait 'til they're in college and send a business leader over there to give a speech about how it's important to show up on time.\"   Out-of-state migration is also of increasing concern in New Mexico. A recent study put the problem in stark terms. It reported migration was happening so fast that by 2030 the population of people 65 and older would double, making New Mexico the state with the fourth highest number of senior citizens. Legislators and business leaders widely agree a problem exists. They just can't agree on how to fix it. Katherine Freeman, president of the United Way of Santa Fe, said she is so grateful for the support of the local business community for early childhood intervention that she generally tries to avoid the elephant in the room. \"I think folks are interested in talking about it as long as it doesn't involve a tax,\" she said. \"Anything that even smells like a tax.\" The tax cuts initiated by Gov. Bill Richardson have effectively stripped the state of its ability to provide education and other services to the people of New Mexico. That is the opinion of Kelly O'Donnell, who served as director of state tax policy under Richardson in 2003-'04. In that role, she oversaw many of that administration's tax rollbacks -- decisions she today regards as ill advised. \"Those tax cuts profoundly impacted the state's ability to pay for its own services that residents need -- and in a lasting way,\" said O'Donnell, now a research economist at University of New Mexico. \"Even if the economy took off, we still couldn't do what we need to do. We're seeing the consequences of that playing out. I think a lot of people who care about children's programs and education don't make the link.\" Though New Mexico has invested deeply in early childhood programs  -- more than $350 million a year for 2017 and 2018 -- it has barely moved the needle. According to the 2016 Kids Count Data Book from the Annie E. Casey Foundation, only 17 percent of New Mexico fourth-graders are proficient in reading and 22 percent of eighth-graders proficient in math. Those figures compare unfavorably to the rest of the nation, which is itself lagging significantly behind other countries. Only 35 percent of American fourth graders are proficient in reading; 32 percent of eighth graders are proficient in math. Despite New Mexico's investment in early education, the financial commitment remains insufficient to meet the need. While 71,000 students are deemed eligible to participate in K3 Plus, a program that extends the school year by 25 instructional days, state funding provides for only 18,832 children. That's a gap of 52,168 children who don't get the education they need to be competitive. \"Early education has a lot of bipartisan support, but once you get down to brass tacks -- how to pay for it -- that's when the wheels come off the bus,\" O'Donnell said.   \"You can't do it for free, you have to raise taxes. And until we address that, we're fooling ourselves if we just sing 'Kumbaya' and say early childhood  education is a good thing.\"   Searchlight New Mexico ( www.searchlightnm.com ) is a non-partisan, nonprofit news organization dedicated to investigate journalism in the interest of New Mexico residents."},{"1":"doc5","2":"http://krwg.org/post/new-mexico-texas-water-dispute-reaches-us-supreme-court","3":"KRWG","4":"New Mexico","5":"Sun, 28 Jan 2018 15:46:07 GMT","6":"2018-01-28","7":"New Mexico - Texas Water Dispute Reaches The U.S. Supreme Court By sarah tory-high country news . 2 hours ago Tweet Share Google+ Email Credit Elephant Butte Dam / Sarah Tory-High Country News   Southern New Mexico's Mesilla Valley is like an island: a fertile patchwork of farm fields and groves of pecan trees surrounded by the brown Chihuahuan Desert.    For Mesilla Valley farmers, the metaphor rings true in other ways as well. Though they live in New Mexico, the residents of the roughly 90,000-acre-area are caught between their own state and Texas. The Rio Grande water they depend on is not technically New Mexico's water, but rather part of the water that goes to Texas under the Rio Grande Compact, a treaty ensuring that Texas, New Mexico and Colorado get their fair share of the river. New Mexico's delivery obligation to Texas hinges on collecting enough water in Elephant Butte Reservoir, 90 miles from the Texas border and the neighboring Mesilla Valley. Unfortunately, that leaves the farmers downriver in a complicated no-man's-land of interstate water management. \"We cringe when we hear, 'Not one more drop to Texas,' because that means not one more drop for us,\" says Samantha Barncastle, the lawyer for the Elephant Butte Irrigation District, which manages and delivers irrigation water to Mesilla Valley farmers.  After more than a decade of back-and-forth between New Mexico and Texas, the fight has finally reached the Supreme Court. The first round of oral arguments took place on Jan. 8, with a final decision expected by early spring. For the farmers, the conflict has only heightened their sense of isolation from their own state - and made the costs of poor water management in a hotter and drier West more obvious than ever. Built in 1916 by the Bureau of Reclamation, Elephant Butte Dam made a large-scale agricultural economy possible in New Mexico's dry south. But disputes between states over the river continued, especially during times of drought.   The latest stems from a 2014 lawsuit filed by the state of Texas, claiming that by allowing farmers in southern New Mexico to pump groundwater, New Mexico was depleting the water destined for Texas under the Rio Grande Compact. Farmers in the Mesilla Valley receive a yearly allocation of 36 inches of water per acre from the reservoir, as long as flows in the Rio Grande are sufficient. But in the 1950s, a severe drought curtailed that allotment. To supplement irrigation supplies, the Bureau of Reclamation encouraged local farmers to pump groundwater. \"Everyone did,\" recalls Robert Faubion, a fourth-generation local farmer. When the current drought began in 2003, farmers came to rely more on their groundwater wells, sometimes receiving almost 80 percent of their yearly irrigation needs from the aquifer. (The region's towns and cities, including Las Cruces, rely 100 percent on groundwater.) According to the U.S. Geological Survey Mesilla Basin Monitoring Program, between 2003 and 2005 the Mesilla Valley aquifer declined by up to 5 feet and held steady until 2011, when it began dropping sharply again. In some places, groundwater levels fell by 18 feet. As the situation worsened, the Elephant Butte Irrigation District and its longtime rival in Texas, the El Paso County Water Improvement District, agreed that the time had come to resolve their grievances. So the two agencies settled on an \"operating agreement\" in 2008, which required New Mexico to relinquish some of its Rio Grande water to Texas in exchange for Texas ceasing its complaints about groundwater pumping. The signing coincided with Valentine's Day. \"We had sort of a love fest,\" says Gary Esslinger, the treasurer and manager of the Elephant Butte Irrigation District. The love lasted until 2011, when, in a surprise move, then-New Mexico Attorney General Gary King sued the irrigation district and the El Paso County Water Improvement District No. 1 as well as the Bureau of Reclamation, arguing that the deal gave away too much of New Mexico's water. The decision to sue one of its own irrigation districts was, to Barncastle, \"incredibly strange.\" In 2014, Texas fired back with its own lawsuit against New Mexico, bringing us to today's scenario: If the Supreme Court rules against New Mexico, the state budget will take a hit. New Mexico could owe billions of dollars in damages - on top of the $15 million already spent on legal fees - and potentially have to find additional sources of water to send to Texas, as a way to make up for its groundwater pumping. According to Barncastle, the case is motivating stakeholders in southern New Mexico to work on a framework for better groundwater management. The impacts of climate change are adding yet another layer of uncertainty, since no one knows how weather patterns might affect water scarcity in the future. Regardless, the outcome will have major implications, says southern New Mexico Sen. Joe Cervantes. Most of the state's population and industry is located along the riparian corridor. \"If the health of the Rio Grande is threatened, then all of those communities are put at risk,\" Cervantes warned. This story was originally published at High Country News (hcn.org) on 1/23/18"},{"1":"doc6","2":"http://nmindepth.com/2018/01/28/breaking-down-lawmakers-bills-on-kids-and-families/","3":"New Mexico In Depth","4":"Breaking down lawmakers' bills on kids and families","5":"Sun, 28 Jan 2018 09:37:12 GMT","6":"2018-01-28","7":"Subscribe to 2018 Legislative Session Andrés Leighton for Searchlight New Mexico Estrella Becerra, pre-K coordinator for the Gadsden Independent School District, watches Matthew Gonzalez color at Anthony Elementary's \"On Track\" pre-K in Anthony, New Mexico. The state pre-K program serves about 8,400 children through public schools and private child care centers. New Mexico ranks 49th in child well-being. Wonder what the state's lawmakers are doing about it? We looked at 2,586 legislative ideas on kids and families so you don't have to. Here's what we learned: Lawmakers proposed more than double the number of bills, memorials and resolutions during the Richardson administration than during the Martinez administration. The database shows lawmakers proposed 1,749 legislative initiatives under Democrat Gov. Bill Richardson and 837 initiatives under Republican Gov. Susana Martinez. Does that mean the Richardson administration did more for kids than the Martinez administration? Not necessarily. The total volume of all bills proposed in the eight years under Richardson was bigger: nearly 16,000 compared with slightly more than 9,000. The Martinez count is one year short because the last session of her tenure has just begun. It can be argued that the Legislature has been more effective - or at least more efficient - over the past seven years. The Legislature has gotten about 19 percent of initiatives on kids passed under Martinez, with her signature. About 15 percent of such initiatives passed on Richardson's watch. Inflating the bill volume in the Richardson years were hundreds of one-paragraph funding requests for small-time projects. In the years when New Mexico was cash-flush, these bills - critics would call them pork - would die during the session but then found their way into a secondary budget bill, the \"HB2 Jr.\" For example, the 2008 \"junior\" budget bill included $43,000 for a youth holiday in Bernalillo; $8,000 for an Albuquerque teen drug treatment program; and $27,000 for a Roswell science fair for kids, among dozens of other line items. There have been no such \"junior\" bills under Martinez, who has spent most of her tenure climbing out of a recessionary budget hole. Yeah, but what about politics? This article is part of a year-long reporting project centered on child-wellbeing in New Mexico, produced by Searchlight New Mexico, a nonprofit, nonpartisan media organization that seeks to empower New Mexicans to demand honest and effective public policy. Politically, advocates argue Richardson had a more ambitious agenda related to the well-being of kids. And indeed, more sweeping changes did occur, including the creation of what is now the Public Education Department, the beginning of state-funded preschool and the formation of a Children's Cabinet. Furthermore, under Richardson, lawmakers and voters agreed to fund a multi-year raise for teachers with money from the Land Grant Permanent Fund. Martinez - who called Richardson's initiatives \"irresponsible spending during prosperous times\" in her most recent \"State of the State\" address - began with her own ambitious agenda to improve the quality of New Mexico public schools. It delivered mixed legislative results. Martinez achieved most of her education agenda - including high-stakes testing, teacher evaluations and Common Core standards - administratively. She won legislative reforms such as the introduction of school grades and some educational appropriations but couldn't get lawmakers to agree on ending \"social promotion,\" her proposal to hold back third-graders who can't read. \"Martinez had a Democratic Senate for her entire tenure and a Democratic House for all but two years of it,\" said Fred Nathan, executive director of Think New Mexico, a Santa Fe-based think tank. \"With divided government, there is less likelihood that bills will both pass and be signed, which discourages some legislators from introducing them in the first place.\" Unsurprisingly, bipartisan legislative actions have a better chance of passing than either all-Democrat or all-Republican efforts. The bad news? Less than 3 percent of bills, etc., were bipartisan. Just 73 of 2,586 legislative actions had bipartisan support. Bipartisan actions were slightly more likely to pass the Legislature and be signed by the governor than actions sponsored by only one party. Bipartisan actions were passed at a rate of 20 percent, or 15 of 73. Compare that with Democratic ideas, 16 percent of which passed - 334 of 2,026 - or Republican, 14 percent of which passed, or 68 of 476. Democrats have controlled far more seats in the Legislature than Republicans over the past 15 years, which in part explains the bigger volume of Democratic proposals. Here's what the database says about what successful and failed initiatives had in common: Initiatives for kids that were successful - and bipartisan - were often voluntary, research-based, solutions-oriented and targeted to the neediest population. That's when legislators crossed party lines. Proposals that were mandatory, universal, unrooted in research and regarded as punitive to kids were likely to drive lawmakers into their political corners and fail. Also likely to fail: proposals that would fundamentally alter the status quo. That's unsurprising, given New Mexico's \"traditionalist\" political culture - an academic label for regions where decisionmakers seek \"to maintain the existing order and the status quo,\" says Lonna Atkeson, a political science professor at University of New Mexico. \"It's hard to move forward, especially when you are poor.\" Subscribe for New Mexico In Depth stories and news direct to your inbox ___________________________________________________________________ New Mexico In Depth thanks our members and sponsors. New Mexico In Depth is funded by donations from organizations and individuals who support our mission. Please consider contributing by becoming a member or making a one-time donation ."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

Corpus preparation
------------------

Also, PrepText(). Although, I think it may not work on TIF. Hyphenated words and any excessive spacing in texts. Upstream solution.

Using the ... `cleanNLP` package.

``` r
cleanNLP::cnlp_init_udpipe(model_name="english",feature_flag = FALSE, parser = "none") 
## Loading required namespace: udpipe
#cnlp_init_corenlp(language="en",anno_level = 1L)
ann_corpus <- cleanNLP::cnlp_annotate(nm_news$txt, as_strings = TRUE) 
```

### SetSearchCorpus()

This function performs some cleaning ... It will ... any/all annotation types in theory. Output, however, homogenizes column names to make things easier downstream. Naming conventions established in the `spacyr` package are adopted here. The function performs two or three general tasks. Eliminates spaces. Annotation form varies depending on the annotator, as different folks have different

Adds tuples and their chraracter onsets/offsets. A fairly crude corpus querying language

Lastly, the function splits corpus into a list of dataframes by doc\_id. This facilitates ... any easy solution to ...

``` r
lingr_corpus <- ann_corpus$token %>%
  SetSearchCorpus(doc_var='id', 
                  token_var='word', 
                  lemma_var='lemma', 
                  tag_var='pos', 
                  pos_var='upos',
                  sentence_var='sid',
                  NER_as_tag = FALSE)
```

### GetDocDesc()

``` r
corpuslingr::GetDocDesc(lingr_corpus)$corpus
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["n_docs"],"name":[1],"type":["int"],"align":["right"]},{"label":["textLength"],"name":[2],"type":["int"],"align":["right"]},{"label":["textType"],"name":[3],"type":["int"],"align":["right"]},{"label":["textSent"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"21","2":"13686","3":"3048","4":"812"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

``` r
head(corpuslingr::GetDocDesc(lingr_corpus)$text)
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["doc_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["textLength"],"name":[2],"type":["int"],"align":["right"]},{"label":["textType"],"name":[3],"type":["int"],"align":["right"]},{"label":["textSent"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"text1","2":"958","3":"348","4":"55"},{"1":"text10","2":"1039","3":"427","4":"70"},{"1":"text11","2":"543","3":"256","4":"35"},{"1":"text12","2":"182","3":"106","4":"11"},{"1":"text13","2":"474","3":"200","4":"21"},{"1":"text14","2":"529","3":"247","4":"36"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

Search function and aggregate functions.
----------------------------------------

We also need to discuss special search terms, eg, `keyPhrase` and `nounPhrase`.

### An in-house corpus querying language (CQL)

Should be 'copy and paste' at his point. See 'Corpus design' post. Tuples and complex corpus search.?

### SimpleSearch()

``` r
search1 <- "<_Vx> <up!>"

lingr_corpus %>%
  corpuslingr::SimpleSearch(search=search1)
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["doc_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["token"],"name":[2],"type":["chr"],"align":["left"]},{"label":["tag"],"name":[3],"type":["chr"],"align":["left"]},{"label":["lemma"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"text1","2":"sets up","3":"VBZ RP","4":"set up"},{"1":"text10","2":"grow up","3":"VB RP","4":"grow up"},{"1":"text10","2":"growing up","3":"VBG RP","4":"grow up"},{"1":"text11","2":"shake up","3":"VB RP","4":"shake up"},{"1":"text13","2":"step up","3":"VB IN","4":"step up"},{"1":"text14","2":"climbing up","3":"VBG RP","4":"climbe up"},{"1":"text14","2":"woke up","3":"VBD RP","4":"wake up"},{"1":"text15","2":"stay up","3":"VB IN","4":"stay up"},{"1":"text15","2":"teamed up","3":"VBN RP","4":"team up"},{"1":"text16","2":"setting up","3":"VBG RP","4":"set up"},{"1":"text17","2":"make up","3":"VB RP","4":"make up"},{"1":"text17","2":"venture up","3":"VBP RP","4":"venture up"},{"1":"text18","2":"comes up","3":"VBZ RP","4":"come up"},{"1":"text21","2":"is up","3":"VBZ JJ","4":"be up"},{"1":"text21","2":"partner up","3":"VB RP","4":"partner up"},{"1":"text21","2":"partnered up","3":"VBD RP","4":"partner up"},{"1":"text21","2":"clamber up","3":"VB RP","4":"clamber up"},{"1":"text21","2":"growing up","3":"VBG RP","4":"grow up"},{"1":"text21","2":"grow up","3":"VB RB","4":"grow up"},{"1":"text4","2":"show up","3":"VB RP","4":"show up"},{"1":"text4","2":"Showing up","3":"VBG RP","4":"show up"},{"1":"text4","2":"show up","3":"VB RP","4":"show up"},{"1":"text5","2":"make up","3":"VB RP","4":"make up"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

### GetContexts()

``` r
search4 <- '<all!> <> <of!>'
corpuslingr::GetContexts(search=search4,corp=lingr_corpus,LW=5, RW = 5)%>%
  corpuslingr::GetKWIC()
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["doc_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["lemma"],"name":[2],"type":["chr"],"align":["left"]},{"label":["kwic"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"text15","2":"all four of","3":"Burns came out on in <mark> all four of <\/mark> her events on the ,"},{"1":"text20","2":"all or of","3":"corrections officials holding inmates for <mark> all or of <\/mark> their terms - often because"},{"1":"text21","2":"all sort of","3":"The draws Native vendors and <mark> all sorts of <\/mark> visitors from far and wide"},{"1":"text7","2":"all or of","3":"corrections officials holding inmates for <mark> all or of <\/mark> their terms - often because"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

``` r
nounPhrase
## [1] "(?:(?:<_DT> )?(?:<_Jx> )*)?(?:((<_Nx> )+|<_PRP> ))"
```

### GetSearchFreqs()

``` r
lingr_corpus %>%
  corpuslingr::SimpleSearch(search=search1)%>%
  corpuslingr::GetSearchFreqs(aggBy = 'lemma')
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lemma"],"name":[1],"type":["chr"],"align":["left"]},{"label":["txtf"],"name":[2],"type":["int"],"align":["right"]},{"label":["docf"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"GROW UP","2":"4","3":"2"},{"1":"SHOW UP","2":"3","3":"1"},{"1":"MAKE UP","2":"2","3":"2"},{"1":"PARTNER UP","2":"2","3":"1"},{"1":"SET UP","2":"2","3":"2"},{"1":"BE UP","2":"1","3":"1"},{"1":"CLAMBER UP","2":"1","3":"1"},{"1":"CLIMBE UP","2":"1","3":"1"},{"1":"COME UP","2":"1","3":"1"},{"1":"SHAKE UP","2":"1","3":"1"},{"1":"STAY UP","2":"1","3":"1"},{"1":"STEP UP","2":"1","3":"1"},{"1":"TEAM UP","2":"1","3":"1"},{"1":"VENTURE UP","2":"1","3":"1"},{"1":"WAKE UP","2":"1","3":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

### GetKWIC()

``` r
search2 <- "<_Jx> <and!> <_Jx>"

corpuslingr::GetContexts(search=search2,corp=lingr_corpus,LW=5, RW = 5)%>%
  corpuslingr::GetKWIC()
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["doc_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["lemma"],"name":[2],"type":["chr"],"align":["left"]},{"label":["kwic"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"text10","2":"economic and social","3":"and , and of the <mark> economic and social <\/mark> well - of families ."},{"1":"text10","2":"economic and early","3":", nonpartisan Coming Monday : <mark> Economic and early <\/mark> go in ; shows of"},{"1":"text15","2":"third and fourth","3":"1:00.30 ) finished second , <mark> third and fourth <\/mark> , respectively , at the"},{"1":"text16","2":"warmer and drier","3":"through early , so continued <mark> warmer and drier <\/mark> than normal , \" Fontenot"},{"1":"text16","2":"early and active","3":"We are preparing for an <mark> early and active <\/mark> and bringing some and crews"},{"1":"text20","2":"expensive and long","3":"\" in- . \" An <mark> expensive and long <\/mark> - , it routinely has"},{"1":"text20","2":"overall and fewer","3":"a in women 's rates <mark> overall and fewer <\/mark> - based options for them"},{"1":"text21","2":"more and populous","3":"young brains draining away to <mark> more and populous <\/mark> markets . But there 's"},{"1":"text21","2":"varied and diverse","3":"these human collisions with a <mark> varied and diverse <\/mark> of people that can add"},{"1":"text21","2":"far and wide","3":"all sorts of visitors from <mark> far and wide <\/mark> . The big is the"},{"1":"text21","2":"bigger and bigger","3":"to , you know , <mark> bigger and bigger <\/mark> places ? Alonso Estrada :"},{"1":"text4","2":"economic and early","3":"around the and the that <mark> economic and early <\/mark> go in . And nowhere"},{"1":"text4","2":"early and economic","3":"zeroed in on the between <mark> early and economic <\/mark> well - . His ,"},{"1":"text4","2":"small and large","3":"a statewide that represents 250 <mark> small and large <\/mark> businesses . \" . Showing"},{"1":"text6","2":"honest and effective","3":"empower New Mexicans to demand <mark> honest and effective <\/mark> public . Politically , advocates"},{"1":"text7","2":"expensive and long","3":"\" in- . \" An <mark> expensive and long <\/mark> - , it routinely has"},{"1":"text7","2":"overall and fewer","3":"a in women 's rates <mark> overall and fewer <\/mark> - based options for them"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

### GetBOW()

Vector space model, or word embedding

### GetKeyphrases()

The package has one 'specialty' function... most of this is described more thoroughly in this [post]().

``` r
keyPhrase
## [1] "(<_JJ> )*(<_N[A-Z]{1,10}> )+((<_IN> )(<_JJ> )*(<_N[A-Z]{1,10}> )+)?"
```

``` r
lingr_corpus %>%
  #SimpleSearch() %>% add doc_var ~makes it more generic. key_var
  GetKeyPhrases(n=5, key_var ='lemma', flatten=TRUE,jitter=TRUE)
```

<script data-pagedtable-source type="application/json">
{"columns":[{"label":["doc_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["keyphrases"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"text1","2":"West Texas | western New Mexico | Evans | Buffs | WNm"},{"1":"text10","2":"child | ranking | Minnesota | Casey Foundation | teens"},{"1":"text11","2":"Dunn | Libertarians | Libertarian | party | Republicans"},{"1":"text12","2":"Youth | glitch | Medicaid | Families Department | child"},{"1":"text13","2":"dollar to New Mexico | democratic lawmaker | New Mexico House | NBC | AP Photo"},{"1":"text14","2":"McKenzie Jamieson | West Valley High School | dinosaur | Yakima | light"},{"1":"text15","2":"event | Lobos | Aggy | McGowan | finish"},{"1":"text16","2":"La | Thursday | condition | Pajarito | March"},{"1":"text17","2":"northern New Mexico | Romero | Taos Ski Valley | New Mexico River Outfitters Association | trip"},{"1":"text18","2":"Colorado State | point | Rams | Paige | Jackson"},{"1":"text19","2":"point | New Mexico State | UMKC | Inc | Scripps"},{"1":"text2","2":"Morale | Services | meals on wheels | Long | senior"},{"1":"text20","2":"inmate | Valencia | document | corrections Department | July"},{"1":"text21","2":"Paul Solman | Richard Berry | Kyle Guin | Gary Oppedahl | Lee Francis"},{"1":"text3","2":"area | New Mexico in recent week | outlook | Partners | Forecaster"},{"1":"text4","2":"child | readiness | employee | grader | president"},{"1":"text5","2":"Texas | farmer | Mesilla Valley | Elephant Butte Irrigation District | Rio Grande"},{"1":"text6","2":"Martinez | Richardson | lawmaker | bills | bill"},{"1":"text7","2":"Valencia | inmate | corrections Department | July | document"},{"1":"text8","2":"visit | MST Jan | REPORTED | BEDS | NEWMEXICO"},{"1":"text9","2":"police | SAN JUAN COUNTY | Charles Martinez | NW New Mexico David Lynch January | Chevy"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>

?Reference corpus.
~Perhaps using SOTU.

Multi-term search
-----------------

``` r
#multi-search <- c("")
```

Corpus workflow
---------------

``` r
search4 <- "<_xNP> (<wish&> |<hope&> |<believe&> )"
```
